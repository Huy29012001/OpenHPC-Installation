Add compute node to PBS pro 
# qmgr
create node master
exit
# service pbs restart

Add cpu queue
# qmgr
create queue qcpu 
set queue qcpu queue_type = Execution 
set queue qcpu resources_max.nodect = 1
set queue qcpu resources_default.nodect = 1
set queue qcpu resources_default.nodes = 1:ppn=6
set queue qcpu resources_default.ncpus = 1
set queue qcpu resources_max.ncpus = 6
set queue qcpu max_running=16
set queue qcpu max_queuable=16
set queue qcpu enabled = True 
set queue qcpu started = True
exit
# service pbs restart

Add GPU resource
# qmgr
create resource ngpus type=long, flag=nh
exit
# systemctl stop pbs

Edit <sched_priv directory>/sched_config to add ngpus to the list of scheduling resources:
# vi /var/spool/pbs/sched_priv/sched_config 
resources: “ncpus, mem, arch, host, vnode, ngpus, gpu_id”

Start PBS Server
# systemctl start pbs

Add the number of GPU devices available to each execution host in the cluster via qmgr:
# qmgr
set node master resources_available.ngpus=0
set node master resources_available.ncpus=4
set node c1 resources_available.ngpus=0
set node c1 resources_available.ncpus=10
set node c2 resources_available.ngpus=0
set node c2 resources_available.ncpus=10

vi vnodes-1

$configversion 2
c3: resources_available.ncpus = 8
c3: resources_available.ngpus = 0
c3[0]: resources_available.ncpus = 2 
c3[0]: resources_available.ngpus = 1 
c3[0]: resources_available.gpu_id = gpu0 
c3[0]: sharing = default_excl
c3[1]: resources_available.ncpus = 2 
c3[1]: resources_available.ngpus = 1 
c3[1]: resources_available.gpu_id = gpu1 
c3[1]: sharing = default_excl

pbs_mom -s insert vnodes-1 vnodes-1
 kill -HUP <PID>

# pbsnodes -a
# nvidia-smi -c 1
# nvidia-smi -pm 1


Add GPU queue
# qmgr
create queue qgpu
set queue qgpu queue_type = Execution 
set queue qgpu resources_max.nodect = 1
set queue qgpu resources_default.nodect = 1
set queue qgpu resources_default.nodes = 1:ppn=1
set queue qgpu resources_max.nodes = 1:ppn=6
set queue qgpu resources_default.ngpus = 1
set queue qgpu resources_default.ncpus = 1
set queue qgpu resources_max.ncpus = 6
set queue qgpu resources_max.ncpus = 2
set queue qgpu max_running=3
set queue qgpu max_queuable=3
set queue qgpu enabled = True 
set queue qgpu started = True
exit
